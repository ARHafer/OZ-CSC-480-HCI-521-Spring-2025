<?xml version="1.0" encoding="UTF-8"?>
<server description="Quote Server">

    <!-- Enable features -->
    <featureManager>
        <feature>jakartaee-10.0</feature>
        <feature>microProfile-6.0</feature>
        <feature>mongodb-2.0</feature>
        <feature>mpConfig-3.0</feature>
        <feature>servlet-6.0</feature> <!-- Required for handling HTTP requests -->
    </featureManager>

    <!-- Define server ports -->
    <variable name="http.port" defaultValue="9082"/>
    <variable name="frontend.root" defaultValue="http://localhost:9080"/>

    <httpEndpoint httpPort="${http.port}" httpsPort="9443"
                  id="defaultHttpEndpoint"
                  host="*"/>

    <!-- Web Application Configuration -->
    <webApplication contextRoot="/" location="quote-service.war">
        <appProperties>
            <property name="CONNECTION_STRING" value="${CONNECTION_STRING}"/>
            <property name="ORIGIN" value="${frontend.root}"/>
        </appProperties>
    </webApplication>

    <!-- Enable static content serving -->
    <httpDispatcher enableWelcomePage="true"/>

    <!-- CORS configuration per endpoint -->
    <cors domain="/quotes/*"
          allowedOrigins="${frontend.root}"
          allowedMethods="GET, POST, PUT, DELETE, OPTIONS"
          allowedHeaders="Origin, Content-Type, Accept, Authorization"
          exposeHeaders="Content-Length, Content-Type"
          allowCredentials="true"/>

    <!-- Handle preflight OPTIONS requests -->
    <filter id="CorsFilter" className="com.quoteapp.filters.CorsFilter"/>

    <!-- Default SSL configuration -->
    <ssl id="defaultSSLConfig" trustDefaultCerts="true"/>
</server>
